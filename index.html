<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <div class="container">
    </div>
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
    <script>

      $(function() {
        var currTimeline;
        var $container = $('.container');
        var $feed = $('<section class="feed" />');
        var $timeline = $('<section class="timeline" />');
        var buildTweet = function(data) {
          var $el = $('<div class="tweet" />'); 

          $el.html('<p>@<span class="user">' + data.user + '</span> - ' + '<abbr class="timeago" title="' + data.created_at.toISOString() + '"></abbr>' + ': ' + data.message + '</p>');

          return $el;
        };
        var initTweets = function($container,$feed,dataStream) {
          var i = dataStream.length - 1;

          while(i >= 0) {
            var tweet = dataStream[i];
            var $tweet = buildTweet(tweet);

            $feed.append($tweet);

            --i;
          }

          $container.append($feed);

          $feed.find('abbr.timeago').timeago();
        };
        var upDateTweets = function($feed,dataStream) {
          var currIndex = dataStream.length;

          return setInterval(function() {
            if( dataStream.length > currIndex ) {
              var tweet = dataStream[dataStream.length-1];
              var $tweet = buildTweet(tweet);

              $feed.prepend($tweet);

              $tweet.find('abbr.timeago').timeago();

              currIndex = dataStream.length;
            }
          },100);
        }

        initTweets($container,$feed,streams.home);

        upDateTweets($feed,streams.home);

        $feed.on('click','.user',function() {

          clearInterval(currTimeline);

          $timeline.html('');

          var dataStream = streams.users[this.textContent];

          initTweets($container,$timeline,dataStream);

          currTimeline = upDateTweets($timeline,dataStream);
        });

      });

    </script>
  </body>
</html>
