<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
    <script>

      $(function() {
        var $body = $('body');
        var $tweets = $('<section />');
        var currIndex = streams.home.length;
        var i = currIndex - 1;
        var buildTweet = function(data) {
          var $el = $('<div/>'); 

          $el.html('<p>@' + data.user + ' - ' + '<abbr class="timeago" title="' + data.created_at.toISOString() + '"></abbr>' + ': ' + data.message + '</p>');

          return $el;
        };

        $body.html('');

        while(i >= 0) {
          var tweet = streams.home[i];
          var $tweet = buildTweet(tweet);
          $tweets.append($tweet);
          --i;
        }

        $body.append($tweets);

        $tweets.find('abbr.timeago').timeago();

        setInterval(function() {
          if( streams.home.length > currIndex ) {
            var tweet = streams.home[streams.home.length-1];
            var $tweet = buildTweet(tweet);

            $tweets.prepend($tweet);

            $tweet.find('abbr.timeago').timeago();

            currIndex = streams.home.length;
          }
        },100);

      });

    </script>
  </body>
</html>
